<!DOCTYPE html>
<html lang="ja">

<head>
    <title>音楽</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Bootstrap v5.3.3 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <!-- Import my stylesheet -->
    <link href="../../stylesheet/myStyle.css" type="text/css" rel="stylesheet">
    <link rel="icon" href="../../image/favicon.ico">
</head>

<body>
    <div class="container border-start border-end">
        <h2 class="my-4 p-0 section-title text-center">音楽</h2>
        
        <h5 class="text-center">音楽を作ると、たのしい。</h5>
        
        <h4 class="ms-1">ライセンス</h4>
        <p class="ms-3" xmlns:cc="http://creativecommons.org/ns#">
            以下の作品は、個別の記述が無い限り、
            <a class="link-deep-blue" href="https://creativecommons.org/licenses/by/4.0/?ref=chooser-v1" target="_blank"
                rel="license noopener noreferrer" style="display:inline-block;">
                CC BY 4.0
                <img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;"
                    src="https://mirrors.creativecommons.org/presskit/icons/cc.svg?ref=chooser-v1" alt="">
                <img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;"
                    src="https://mirrors.creativecommons.org/presskit/icons/by.svg?ref=chooser-v1" alt="">
            </a>
            ライセンスの下に提供されます。
        </p>
        <hr>
        <figure class="ms-3">
            <figcaption class="fs-5">Tessyrrhaqt - Welcome</figcaption>
            <audio src="../../audio/welcome.m4a" id="wlcm"></audio>
            <button role="button" class="btn-audio-controls" id="wlcm-play" onclick="musicPlayPause('wlcm')">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16">
                    <path d="m11.596 8.697-6.363 3.692c-.54.313-1.233-.066-1.233-.697V4.308c0-.63.692-1.01 1.233-.696l6.363 3.692a.802.802 0 0 1 0 1.393z"/>
                </svg>
            </button>
            <button role="button" class="btn-audio-controls" id="wlcm-stop" onclick="musicStop('wlcm')">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16">
                    <path d="M5 3.5h6A1.5 1.5 0 0 1 12.5 5v6a1.5 1.5 0 0 1-1.5 1.5H5A1.5 1.5 0 0 1 3.5 11V5A1.5 1.5 0 0 1 5 3.5z"/>
                </svg>
            </button>
            <span id="wlcm-time">0:00</span>
        </figure>


        <div class="d-flex justify-content-center">
            <a class="btn btn-outline-dark" href="../../">戻る</a>
        </div>
    </div>

    <!-- Bootstrap v5.3.3 JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    
    <script>
        const musicList = {};
        const playBtnSvg = '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="m11.596 8.697-6.363 3.692c-.54.313-1.233-.066-1.233-.697V4.308c0-.63.692-1.01 1.233-.696l6.363 3.692a.802.802 0 0 1 0 1.393z"/></svg>';
        const pauseBtnSvg = '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M5.5 3.5A1.5 1.5 0 0 1 7 5v6a1.5 1.5 0 0 1-3 0V5a1.5 1.5 0 0 1 1.5-1.5zm5 0A1.5 1.5 0 0 1 12 5v6a1.5 1.5 0 0 1-3 0V5a1.5 1.5 0 0 1 1.5-1.5z"/></svg>';
        
        let musicPlayPause = function(musicID) {
            const playbtn = document.getElementById(musicID + '-play');
            const duration = document.getElementById(musicID + '-time');
            const path = document.getElementById(musicID).src;

            if (!musicList[musicID]) { // 初回再生
                musicList[musicID] = new Audio(path);
                musicList[musicID].play();
                playbtn.innerHTML = pauseBtnSvg;

                musicList[musicID].addEventListener('ended', function() { // 最後まで再生された場合の処理
                    delete musicList[musicID];
                    playbtn.innerHTML = playBtnSvg;
                    duration.innerHTML = '0:00';
                }, false);

                musicList[musicID].addEventListener('timeupdate', function() { // 経過時間の表示
                    if (musicList[musicID]) {
                        const sec = Math.trunc(musicList[musicID].currentTime) % 60;
                        const min = Math.trunc(musicList[musicID].currentTime / 60);
                        const sec_str = (sec < 10) ? '0' + sec : sec.toString();
                        duration.innerHTML = min.toString() + ':' + sec_str;
                    }
                }, false);

            } else if (musicList[musicID].paused) { // 2回目以降の途中からの再生
                musicList[musicID].play();
                playbtn.innerHTML = pauseBtnSvg;
                
            } else { // 一時停止
                musicList[musicID].pause();
                playbtn.innerHTML = playBtnSvg;
            }
            
            
        }

        let musicStop = function(musicID) { // 停止
            const playbtn = document.getElementById(musicID + '-play');
            const duration = document.getElementById(musicID + '-time');
            const path = document.getElementById(musicID).src;

            if (musicList[musicID]) {
                musicList[musicID].pause();
                musicList[musicID].currentTime = 0;
                delete musicList[musicID];
                playbtn.innerHTML = playBtnSvg;
                duration.innerHTML = '0:00';
            }
        }
        

    </script>


</body>